# OpenWrt make target/linux å‘½ä»¤å®Œæ•´æ±‡æ€»

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æ±‡æ€»äº† OpenWrt æ¡†æ¶ä¸­ `make target/linux` ä¸‹çš„æ‰€æœ‰å¯ç”¨å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤ç”¨äºç®¡ç†å†…æ ¸æºç çš„ä¸‹è½½ã€è§£å‹ã€ç¼–è¯‘å’Œé…ç½®ç­‰æ“ä½œã€‚

## ğŸ¯ æ ¸å¿ƒå‘½ä»¤åˆ—è¡¨

### 1. å†…æ ¸æºç ç®¡ç†å‘½ä»¤

#### `make target/linux/download`
**åŠŸèƒ½**: ä¸‹è½½å†…æ ¸æºç åŒ…
**è¯´æ˜**: ä»å®˜æ–¹æºä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„å†…æ ¸æºç å‹ç¼©åŒ…åˆ° `dl/` ç›®å½•
**ç¤ºä¾‹**:
```bash
make target/linux/download V=s
```

#### `make target/linux/prepare`
**åŠŸèƒ½**: å‡†å¤‡å†…æ ¸æºç ï¼ˆä¸‹è½½ + è§£å‹ + åº”ç”¨è¡¥ä¸ï¼‰
**è¯´æ˜**: è¿™æ˜¯æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œä¼šæ‰§è¡Œå®Œæ•´çš„å†…æ ¸å‡†å¤‡æµç¨‹
**ç¤ºä¾‹**:
```bash
make target/linux/prepare V=s
```

#### `make target/linux/clean`
**åŠŸèƒ½**: æ¸…ç†å†…æ ¸æ„å»ºç›®å½•
**è¯´æ˜**: åˆ é™¤ `build_dir/` ä¸­çš„å†…æ ¸æºç å’Œæ„å»ºæ–‡ä»¶
**ç¤ºä¾‹**:
```bash
make target/linux/clean V=s
```

### 2. å†…æ ¸é…ç½®å‘½ä»¤

#### `make target/linux/oldconfig`
**åŠŸèƒ½**: ä½¿ç”¨ç°æœ‰é…ç½®æ›´æ–°å†…æ ¸é…ç½®
**è¯´æ˜**: åŸºäº `.config` æ–‡ä»¶æ›´æ–°å†…æ ¸é…ç½®ï¼Œå¤„ç†æ–°å¢çš„é…ç½®é€‰é¡¹
**ç¤ºä¾‹**:
```bash
make target/linux/oldconfig V=s
```

#### `make target/linux/menuconfig`
**åŠŸèƒ½**: å¯åŠ¨å†…æ ¸é…ç½®èœå•ç•Œé¢
**è¯´æ˜**: æä¾›äº¤äº’å¼çš„å†…æ ¸é…ç½®ç•Œé¢ï¼Œå¯ä»¥ä¿®æ”¹å†…æ ¸é…ç½®é€‰é¡¹
**ç¤ºä¾‹**:
```bash
make target/linux/menuconfig V=s
```

#### `make target/linux/nconfig`
**åŠŸèƒ½**: å¯åŠ¨åŸºäº ncurses çš„å†…æ ¸é…ç½®ç•Œé¢
**è¯´æ˜**: æä¾›æ›´ç°ä»£çš„æ–‡æœ¬ç•Œé¢é…ç½®å·¥å…·
**ç¤ºä¾‹**:
```bash
make target/linux/nconfig V=s
```

#### `make target/linux/xconfig`
**åŠŸèƒ½**: å¯åŠ¨åŸºäº Qt çš„å›¾å½¢åŒ–å†…æ ¸é…ç½®ç•Œé¢
**è¯´æ˜**: éœ€è¦ X11 æˆ– Qt ç¯å¢ƒæ”¯æŒ
**ç¤ºä¾‹**:
```bash
make target/linux/xconfig V=s
```

### 3. å†…æ ¸ç¼–è¯‘å‘½ä»¤

#### `make target/linux/compile`
**åŠŸèƒ½**: ç¼–è¯‘å†…æ ¸
**è¯´æ˜**: ç¼–è¯‘å†…æ ¸æºç ï¼Œç”Ÿæˆå†…æ ¸é•œåƒæ–‡ä»¶
**ç¤ºä¾‹**:
```bash
make target/linux/compile V=s
```

#### `make target/linux/install`
**åŠŸèƒ½**: å®‰è£…å†…æ ¸
**è¯´æ˜**: å°†ç¼–è¯‘å¥½çš„å†…æ ¸å®‰è£…åˆ°ç›®æ ‡ä½ç½®
**ç¤ºä¾‹**:
```bash
make target/linux/install V=s
```

### 4. è¡¥ä¸ç®¡ç†å‘½ä»¤

#### `make target/linux/update`
**åŠŸèƒ½**: æ›´æ–°å†…æ ¸è¡¥ä¸
**è¯´æ˜**: é‡æ–°åº”ç”¨å†…æ ¸è¡¥ä¸ï¼Œé€šå¸¸åœ¨ä¿®æ”¹è¡¥ä¸åä½¿ç”¨
**ç¤ºä¾‹**:
```bash
make target/linux/update V=s
```

#### `make target/linux/refresh`
**åŠŸèƒ½**: åˆ·æ–°å†…æ ¸è¡¥ä¸
**è¯´æ˜**: é‡æ–°ç”Ÿæˆè¡¥ä¸æ–‡ä»¶ï¼Œé€šå¸¸åœ¨ä¿®æ”¹æºç åä½¿ç”¨
**ç¤ºä¾‹**:
```bash
make target/linux/refresh V=s
```

### 5. è®¾å¤‡æ ‘å‘½ä»¤

#### `make target/linux/dtb`
**åŠŸèƒ½**: ç¼–è¯‘è®¾å¤‡æ ‘æ–‡ä»¶
**è¯´æ˜**: ç¼–è¯‘è®¾å¤‡æ ‘æºæ–‡ä»¶ï¼ˆ.dtsï¼‰ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ.dtbï¼‰
**ç¤ºä¾‹**:
```bash
make target/linux/dtb V=s
```

### 6. å…¶ä»–å‘½ä»¤

#### `make target/linux/prereq`
**åŠŸèƒ½**: æ£€æŸ¥å†…æ ¸æ„å»ºå‰ç½®æ¡ä»¶
**è¯´æ˜**: æ£€æŸ¥æ„å»ºå†…æ ¸æ‰€éœ€çš„å·¥å…·å’Œç¯å¢ƒ
**ç¤ºä¾‹**:
```bash
make target/linux/prereq V=s
```

## ğŸ”§ å‘½ä»¤å‚æ•°è¯´æ˜

### å¸¸ç”¨å‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `V=s` | æ˜¾ç¤ºè¯¦ç»†è¾“å‡º | `make target/linux/prepare V=s` |
| `V=99` | æ˜¾ç¤ºæœ€è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ | `make target/linux/prepare V=99` |
| `-jN` | å¹¶è¡Œç¼–è¯‘ï¼ŒN ä¸ºçº¿ç¨‹æ•° | `make target/linux/compile -j4` |
| `FORCE=1` | å¼ºåˆ¶æ‰§è¡Œï¼Œè·³è¿‡æŸäº›æ£€æŸ¥ | `FORCE=1 make target/linux/prepare` |

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `KERNEL_PATCHVER` | å†…æ ¸ç‰ˆæœ¬ | 6.6 |
| `BOARD` | ç›®æ ‡æ¿ç±»å‹ | imx |
| `TARGET_BUILD` | æ„å»ºç›®æ ‡æ ‡è¯† | 1 |

## ğŸ“ ç›¸å…³ç›®å½•ç»“æ„

### å†…æ ¸æºç ç›®å½•
```
build_dir/target-<arch>_<subtarget>_<libc>_<abi>/linux-<board>_<subtarget>/linux-<version>/
```

### è¡¥ä¸ç›®å½•
```
target/linux/<board>/patches-<kernel_version>/
```

### é…ç½®æ–‡ä»¶ç›®å½•
```
target/linux/<board>/config-<subtarget>
```

### ä¸‹è½½ç›®å½•
```
dl/
```

## ğŸš€ å¸¸ç”¨å·¥ä½œæµç¨‹

### 1. å®Œæ•´çš„å†…æ ¸å‡†å¤‡æµç¨‹
```bash
# 1. é…ç½®ç›®æ ‡å¹³å°
make menuconfig

# 2. å‡†å¤‡å†…æ ¸æºç 
make target/linux/prepare V=s

# 3. é…ç½®å†…æ ¸
make target/linux/menuconfig V=s

# 4. ç¼–è¯‘å†…æ ¸
make target/linux/compile V=s
```

### 2. å†…æ ¸è¡¥ä¸å¼€å‘æµç¨‹
```bash
# 1. å‡†å¤‡å†…æ ¸æºç 
make target/linux/prepare V=s

# 2. è¿›å…¥å†…æ ¸æºç ç›®å½•
cd build_dir/target-*/linux-*/linux-*/

# 3. ä¿®æ”¹æºç 
# ... è¿›è¡Œä¿®æ”¹ ...

# 4. ç”Ÿæˆè¡¥ä¸
quilt refresh

# 5. æ›´æ–°è¡¥ä¸
cd ../../../../
make target/linux/update V=s
```

### 3. æ¸…ç†å’Œé‡æ–°å¼€å§‹
```bash
# 1. æ¸…ç†å†…æ ¸æ„å»º
make target/linux/clean V=s

# 2. é‡æ–°å‡†å¤‡
make target/linux/prepare V=s
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç³»ç»Ÿè¦æ±‚
- **GNU make**: éœ€è¦ 4.1+ ç‰ˆæœ¬
- **ç£ç›˜ç©ºé—´**: å†…æ ¸æºç éœ€è¦ 1-2GB ç©ºé—´
- **å†…å­˜**: ç¼–è¯‘æ—¶éœ€è¦ 2-4GB RAM

### 2. å¸¸è§é—®é¢˜
- **æƒé™é—®é¢˜**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®ç›¸å…³ç›®å½•
- **ç½‘ç»œé—®é¢˜**: ä¸‹è½½å†…æ ¸æºç éœ€è¦ç½‘ç»œè¿æ¥
- **ä¾èµ–é—®é¢˜**: ç¡®ä¿æ‰€æœ‰æ„å»ºä¾èµ–å·²å®‰è£…

### 3. æ€§èƒ½ä¼˜åŒ–
- **å¹¶è¡Œç¼–è¯‘**: ä½¿ç”¨ `-jN` å‚æ•°åŠ é€Ÿç¼–è¯‘
- **ç¼“å­˜**: åˆ©ç”¨ ccache åŠ é€Ÿé‡å¤ç¼–è¯‘
- **SSD**: ä½¿ç”¨ SSD å­˜å‚¨æå‡ I/O æ€§èƒ½

## ğŸ“Š å‘½ä»¤æ‰§è¡Œæ—¶é—´å‚è€ƒ

| å‘½ä»¤ | å…¸å‹æ‰§è¡Œæ—¶é—´ | è¯´æ˜ |
|------|-------------|------|
| `download` | 1-5 åˆ†é’Ÿ | å–å†³äºç½‘ç»œé€Ÿåº¦ |
| `prepare` | 5-15 åˆ†é’Ÿ | åŒ…æ‹¬ä¸‹è½½ã€è§£å‹ã€åº”ç”¨è¡¥ä¸ |
| `compile` | 10-60 åˆ†é’Ÿ | å–å†³äºç¡¬ä»¶é…ç½® |
| `menuconfig` | å³æ—¶ | å¯åŠ¨é…ç½®ç•Œé¢ |

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†è¾“å‡º
```bash
make target/linux/prepare V=99
```

### 2. æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬
```bash
cat build_dir/target-*/linux-*/linux-*/Makefile | grep VERSION
```

### 3. æ£€æŸ¥è¡¥ä¸çŠ¶æ€
```bash
ls -la build_dir/target-*/linux-*/linux-*/.pc/
```

### 4. æ£€æŸ¥æ„å»ºæ—¥å¿—
```bash
tail -f logs/build.log
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [OpenWrt å®˜æ–¹æ–‡æ¡£](https://openwrt.org/docs/)
- [Linux å†…æ ¸æ–‡æ¡£](https://www.kernel.org/doc/)
- [OpenWrt å¼€å‘æŒ‡å—](https://openwrt.org/docs/guide-developer/)

---

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-08-04  
**é€‚ç”¨ OpenWrt ç‰ˆæœ¬**: ä¸»çº¿ç‰ˆæœ¬  
**å†…æ ¸ç‰ˆæœ¬**: 6.6+
